# 柔整 Ver3 金額計算 テストケース（TESTCASES.md）

最終更新: 2026-02-16  
参照: SPEC.md（柔整 Ver3 金額計算 仕様書）

---

## 0. 共通前提

- 日数計算:
  - 受傷日経過 = 来院日 - 受傷日（受傷日=0, 翌日=1）
  - 前回来院差 = 来院日 - 前回来院日
- 別ケース判定:
  - UIでcaseKey新規作成 → 別ケース
- 患者×月上限（当月1回）:
  - 初検料 / 再検料 / 相談支援料
- 「次回来院日」定義:
  - 当月に初検料を算定した日より後の、最初の来院日
- 実装安全弁:
  - 算定不可でもチェックは残す、金額0、要確認TRUE、要確認理由へ記録

---

## 1. テストケース一覧（概要）

- TC01: 同月・通常（初検→次回来院で再検）
- TC02: 同月・別ケース初回（初検抑制＋要確認）
- TC03: 月またぎ・別ケース初回（初検OK）
- TC04: 30日境界（30日継続 / 31日リセット）
- TC05: 冷罨法（打撲/捻挫 受傷0-1日のみ）
- TC06: 温/電（捻挫 受傷5日経過後のみ）
- TC07: 温/電（骨折 受傷7日経過後のみ）
- TC08: 冷罨法（脱臼 0-4日のみ）
- TC09: 月内上限の再検抑制（別ケースでも再検は月1回）
- TC10: 複合（同月別ケース＋加算算定不可＋要確認理由複数）

---

## TC01: 同月・通常（初検→次回来院で再検）

### 入力
- 患者: P001
- 2026/02/03 caseKey=A 新規（初回）
- 2026/02/06 caseKey=A 継続（前回来院差=3日）

### 期待値
- 2/3:
  - 区分=初検
  - 初検料=1, 相談支援料=1, 再検料=0
  - 後療料=0
  - 要確認=FALSE
- 2/6:
  - 区分=後療（※再検料算定日でも区分表記は運用次第だが、少なくとも「後療料を算定」）
  - 再検料=1（当月初検の次回来院）
  - 後療料=1（再検＋後療）
  - 初検料=0, 相談支援料=0
  - 要確認=FALSE

---

## TC02: 同月・別ケース初回（初検抑制＋要確認）

### 入力
- 患者: P001
- 2026/02/03 caseKey=A 新規（初検算定済）
- 2026/02/10 caseKey=B 新規（同月別ケース初回）

### 期待値
- 2/10:
  - 区分=後療（同月抑制）
  - 初検料=0, 相談支援料=0
  - 再検料=0（同月初検の次回来院が別日に既に消化済、または次回来院条件未満）
  - 後療料=1（施術実態があれば）
  - 要確認=TRUE
  - 要確認理由に「同月別ケース初回 初検抑制」等が残る（文言は実装定義）

---

## TC03: 月またぎ・別ケース初回（初検OK）

### 入力
- 患者: P001
- 2026/01/20 caseKey=A 新規（1月初検）
- 2026/02/02 caseKey=B 新規（2月別ケース初回）

### 期待値
- 2/2:
  - 区分=初検
  - 初検料=1, 相談支援料=1
  - 再検料=0
  - 後療料=0
  - 要確認=FALSE

---

## TC04: 30日境界（30日継続 / 31日リセット）

### 入力
- 患者: P001
- 2026/01/05 caseKey=A 新規（初検）
- 2026/02/04 来院（前回来院差=30日）
- 2026/02/05 来院（前回来院差=31日） ※比較用

### 期待値
- 2/4:
  - 30日以内 → 継続（後療）
  - 初検料=0
- 2/5:
  - 30日超 → 初検リセット（初検扱い）
  - 当月初検が未算定なら初検料=1, 相談支援料=1
  - 要確認=FALSE（抑制ではない）

---

## TC05: 冷罨法（打撲/捻挫 受傷0-1日のみ）

### 入力
- 患者: P001
- 傷病=捻挫, 受傷日=2026/02/01
- 2/01 来院（経過0日）冷チェックON
- 2/02 来院（経過1日）冷チェックON
- 2/03 来院（経過2日）冷チェックON

### 期待値
- 2/01: 冷=算定可（>0）
- 2/02: 冷=算定可（>0）
- 2/03: 冷=算定不可（0）
  - チェックは残る
  - 要確認=TRUE
  - 要確認理由: 「冷罨法 算定不可（捻挫：受傷後2日）」等

---

## TC06: 温/電（捻挫 受傷5日経過後のみ）

### 入力
- 患者: P001
- 傷病=捻挫, 受傷日=2026/02/01
- 2/05 来院（経過4日）温/電チェックON
- 2/06 来院（経過5日）温/電チェックON

### 期待値
- 2/05: 温=0, 電=0（算定不可）
  - 要確認=TRUE, 理由記録
- 2/06: 温>0, 電>0（算定可）
  - 要確認は算定不可が無ければFALSE

---

## TC07: 温/電（骨折 受傷7日経過後のみ）

### 入力
- 患者: P001
- 傷病=骨折, 受傷日=2026/02/01
- 2/07 来院（経過6日）温/電チェックON
- 2/08 来院（経過7日）温/電チェックON

### 期待値
- 2/07: 温=0, 電=0（算定不可）
- 2/08: 温>0, 電>0（算定可）

---

## TC08: 冷罨法（脱臼 0-4日のみ）

### 入力
- 患者: P001
- 傷病=脱臼, 受傷日=2026/02/01
- 2/05 来院（経過4日）冷チェックON
- 2/06 来院（経過5日）冷チェックON

### 期待値
- 2/05: 冷>0（算定可）
- 2/06: 冷=0（算定不可）＋要確認TRUE＋理由

---

## TC09: 月内上限の再検抑制（別ケースでも再検は月1回）

### 入力
- 患者: P001
- 2/01 caseKey=A 新規（初検）
- 2/03 来院（次回来院）→ 再検算定（ここで当月再検が消化）
- 2/10 caseKey=B 新規（同月別ケース初回：初検抑制）
- 2/12 来院（Bの次回来院相当）→ 本来なら再検っぽいが上限で抑制

### 期待値
- 2/12:
  - 再検料=0（当月再検は既に1回算定済）
  - 後療料は施術実態があれば算定可
  - 要確認=（算定不可が無ければFALSE、ただしB初回抑制の履歴としてTRUE運用なら仕様に合わせる）

---

## TC10: 複合（同月別ケース＋加算算定不可＋理由複数）

### 入力
- 患者: P001
- 2/01 caseKey=A 新規（初検算定）
- 2/03 来院（次回来院で再検算定）
- 2/10 caseKey=B 新規（同月別ケース初回）
  - 傷病=捻挫, 受傷日=2/01
  - 冷チェックON（経過9日 → 冷は不可）
  - 温/電チェックON（経過9日 → 温/電は可）

### 期待値
- 2/10:
  - 区分=後療（同月初検抑制）
  - 初検料=0, 相談支援料=0
  - 再検料=0（当月再検は既に消化済）
  - 後療料=1（施術実態があれば）
  - 冷=0（算定不可、チェック残す）
  - 温>0, 電>0（算定可）
  - 要確認=TRUE
  - 要確認理由に以下を両方含む（;区切り）
    - 同月別ケース初回 初検抑制
    - 冷罨法 算定不可（捻挫：受傷後9日）

---